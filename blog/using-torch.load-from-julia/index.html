<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <meta name="description" content="Using torch.load from Julia"> 
  <meta name="robots" content="index, follow, max-snippet:-1, max-video-preview:-1, max-image-preview:large"/>
  <link rel="canonical" href="https://opensourc.es/blog/using-torch.load-from-julia/" />
  <meta property="og:url" content="blog/2021-03-14-using-torch.load-from-julia" />
<meta property="og:title" content="Using torch.load from Julia" />
<meta property="og:image" content="nothing" />
<meta property="og:type" content="article" />
<meta property="og:description" content="Using torch.load from Julia" />
<meta property="og:published_time" content="2021-03-14" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@opensourcesblog" />
<meta name="twitter:creator" content="@opensourcesblog" />

  
  
   <link rel="stylesheet" href="/libs/highlight.js/styles/github.min.css">
   

  <link href="/css/vela.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/opensources_74cc4b0d4d9cd3d.css">
  <!-- <link rel="stylesheet" href="/css/OSTheme.css"> -->
  <script src="/libs/vela/jquery.min.js"></script>
  <link rel="icon" href="/assets/favicon.png">
  
     <title>Using torch.load from Julia</title>  
  

</head>
<body>
  <div class="main-nav" id="menu">
    <div class="flex-container">
      <span class="sidebar-brand">
        <h3 style='font-size: 25px'><a href="http://twl.opensourc.es">TWL.OpenSourc.ES</a></h3>
      </span>
    </div> <!-- class="flex-container" -->

    <nav class="sidebar-nav">
      <ul class="metismenu"  id="metismenu" >
        <li><a href="/index.html">Home</a></li>
        <form id="lunrSearchForm" name="lunrSearchForm" action="/search/index.html">
          <input class="search-input" name="q" placeholder="Enter search term" type="text">
        </form>
        <!--
        {{navbar constraint-solver}}
        {{navbar javis}}
        {{navbar julia-basics}}
        {{navbar side-gigs}}
        {{navbar kaggle-santa}}
        {{navbar blog}}
        {{navbar simplex}}
        {{navbar visualization}}
        {{navbar neuro}}
        {{navbar machine-learning}}
        {{navbar mnist}}
        -->
      </ul>
    </nav>
  </div> <!-- main nav menu -->

  <main id="panel">
    <div class="toggle-button hamburger hamburger--spin">
      <div class="hamburger-box">
        <div class="hamburger-inner"></div>
      </div>
    </div>
    
    <h1 class="page title">Using torch.load from Julia</h1>
    
    <hr>
    
    <p class="date">Creation date: 2021-03-14</p>
    <p class="post_author">Author: Gregory Sech</p>
    <p class="tags">Tags: <a href="../../tag/pycall">pycall</a>, <a href="../../tag/pytorch">pytorch</a></p>
    



<!-- Content appended here --><div class="franklin-content"><p>As part of an experiment we needed to solve a large quantity of linear inequalities described by the coefficient of a very sparse matrix. </p>
<p>These coefficients were calculated using <a href="https://pytorch.org">PyTorch</a> by a collegue and, after solving them within <a href="https://www.python.org">Python</a> with an ad-hoc algorithm, I wanted to solve the system by using a LP solver via <a href="https://jump.dev">JuMP</a>.</p>
<p>I&#39;m a novice of <a href="https://julialang.org/">Julia</a> but recently, on <a href="https://www.youtube.com/watch?v&#61;sLdlIs_e07E">the Beginners AMA featuring Dr. Katharine Hyatt and Dr. Rachel Kurchin</a>, I&#39;ve heard about an interesting package called <a href="https://github.com/JuliaPy/PyCall.jl">PyCall.jl</a>. This provides the ability to call Python modules directly from Julia programs.</p>
<p>The setup was quite easy, I just had to follow the instructions of <a href="https://github.com/JuliaPy/PyCall.jl/blob/master/README.md">PyCall.jl&#39;s README</a> about using a different version of Python as I have installed PyTorch in a Anaconda&#39;s environment.</p>
<p>It was really easy, I just copied the path to the correct executable and before doing <code>add PyCall</code> I&#39;ve set the <code>PYTHON</code> environment variable directly from the Julia REPL then entered Pkg REPL-mode by pressing <code>&#93;</code> and finally added PyCall.    For a full description of the procedure everything is described in the README mentioned above.</p>
<p>After that loading data from PyTorch was pretty straightforward but let me walk you through it:</p>
<pre><code class="language-julia">using SparseArrays, PyCall

@pyimport torch

data_dict &#61; torch.load&#40;&quot;&lt;path to my data&gt;&quot;, map_location&#61;torch.device&#40;&quot;cpu&quot;&#41;&#41;
C_rows &#61; data_dict&#91;&quot;ids&quot;&#93;&#91;0&#93;.numpy&#40;&#41; .&#43; 1
C_cols &#61; data_dict&#91;&quot;ids&quot;&#93;&#91;1&#93;.numpy&#40;&#41; .&#43; 1
C_values &#61; data_dict&#91;&quot;values&quot;&#93;.numpy&#40;&#41;
C &#61; sparse&#40;C_rows, C_cols, C_values&#41;</code></pre>
<ol>
<li><p>I&#39;ve used <code>PyCall</code> to import the <code>torch</code> module from Python.</p>
</li>
<li><p>Called torch.load as if I was in Python &#40;with the only difference that Julia doesn&#39;t allow for single quotes as string delimiters&#41; to load my data, which is a dictionary of tensors.</p>
</li>
<li><p>By reading PyCall&#39;s README I&#39;ve discovered that numpy&#39;s arrays are automatically converted into an interoperable array type in Julia. I just needed to add a &#43;1 as Julia&#39;s indexing starts from 1 by default and didn&#39;t really want to mess with <a href="https://docs.julialang.org/en/v1/devdocs/offset-arrays/">custom indices</a>.</p>
</li>
<li><p>After I&#39;ve got all my data loaded I just needed to create my sparse matrix <code>C</code> using <code>sparse</code> from the <a href="https://docs.julialang.org/en/v1.5/stdlib/SparseArrays/"><code>SparseArrays</code> module of the Standard Library</a>.</p>
</li>
</ol>
<p>So today we learned that Julia interpoperabilty with Python is quite easy, even with non standard modules like PyTorch, and that using Numpy&#39;s arrays to move data between languages is really neat and painless&#33;</p>
                          

<div class="page-foot">
  <div>
    <a href="/feed.xml">Subscribe to RSS</a>
  </div>
  <div class="copyright">
    &copy; Ole Kröger. Last modified: March 14, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div></div><!-- CONTENT ENDS HERE -->
  </main> <!-- end of id=main -->
  <script src="/libs/vela/metisMenu.min.js"></script>
  <script src="/libs/vela/slideout.min.js"></script>
  <script src="/libs/lunr/lunr.min.js"></script>
  <script src="/libs/lunr/lunr_index.js"></script>
  <script src="/libs/lunr/lunrclient.min.js"></script>
  <script>
(function(){

    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.

    var pre = document.getElementsByTagName('pre');

    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.

    for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].className.indexOf('language-');

        if ( isLanguage === 0 ) {
            var button           = document.createElement('button');
                    button.className = 'copy-button';
                    button.textContent = 'Copy';

                    pre[i].appendChild(button);
        }
    };

    // Run Clipboard

    var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
            return trigger.previousElementSibling;
    }
    });

    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.

    copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
            event.trigger.textContent = 'Copy';
        }, 2000);

    });

    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.

    copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
            event.trigger.textContent = 'Copy';
        }, 5000);
    });

})();
</script> 
  
   <script src="/libs/highlight.js/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
   
</body>
</html>
